<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>从零开始的URP仿原神角色渲染 | Yui Lu</title><meta name="author" content="Yui Lu"><meta name="copyright" content="Yui Lu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="早期学习卡通渲染的一些记录（图片施工中）">
<meta property="og:type" content="article">
<meta property="og:title" content="从零开始的URP仿原神角色渲染">
<meta property="og:url" content="https://yuilu.github.io/posts/44076.html">
<meta property="og:site_name" content="Yui Lu">
<meta property="og:description" content="早期学习卡通渲染的一些记录（图片施工中）">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://yuilu.github.io/images/cover/result.png">
<meta property="article:published_time" content="2024-01-17T08:00:00.000Z">
<meta property="article:modified_time" content="2024-01-17T15:20:18.612Z">
<meta property="article:author" content="Yui Lu">
<meta property="article:tag" content="Blogs">
<meta property="article:tag" content="卡通渲染">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://yuilu.github.io/images/cover/result.png"><link rel="shortcut icon" href="/img/favicon-32x32-Arlecchino.png"><link rel="canonical" href="https://yuilu.github.io/posts/44076.html"><link rel="preconnect" href="//cdnjs.cloudflare.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css?v=4.12.0"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.32/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":730,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdnjs.cloudflare.com/ajax/libs/egjs-infinitegrid/4.11.0/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '从零开始的URP仿原神角色渲染',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-01-17 23:20:18'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.0.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/bocchi.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">17</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Timeline</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/notes/"><i class="fa-fw fas fa-edit"></i><span> Note</span></a></li><li><a class="site-page child" href="/blogs/"><i class="fa-fw fas fa-file-alt"></i><span> Blog</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> Life</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/travel/"><i class="fa-fw fas fa-plane-departure"></i><span> Travel</span></a></li><li><a class="site-page child" href="/animes/"><i class="fa-fw fas fa-mug-hot"></i><span> ACGN</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-user"></i><span> About</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/about_cn/"><span> 简体中文</span></a></li><li><a class="site-page child" href="/about_en/"><span> English</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/images/topimg/%7B04C1544E-4D28-47b3-941B-2F7767E3BD07%7D.png')"><nav id="nav"><span id="blog-info"><a href="/" title="Yui Lu"><span class="site-name">Yui Lu</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Timeline</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/notes/"><i class="fa-fw fas fa-edit"></i><span> Note</span></a></li><li><a class="site-page child" href="/blogs/"><i class="fa-fw fas fa-file-alt"></i><span> Blog</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> Life</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/travel/"><i class="fa-fw fas fa-plane-departure"></i><span> Travel</span></a></li><li><a class="site-page child" href="/animes/"><i class="fa-fw fas fa-mug-hot"></i><span> ACGN</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-user"></i><span> About</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/about_cn/"><span> 简体中文</span></a></li><li><a class="site-page child" href="/about_en/"><span> English</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">从零开始的URP仿原神角色渲染<a class="post-edit-link" href="null_posts/从零开始的URP仿原神角色渲染.md" title="编辑" target="_blank"><i class="fas fa-pencil-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-01-17T08:00:00.000Z" title="发表于 2024-01-17 16:00:00">2024-01-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-01-17T15:20:18.612Z" title="更新于 2024-01-17 23:20:18">2024-01-17</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="从零开始的URP仿原神角色渲染"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>从去年到现在学习TA已经大概有半年多了，最近也开始逐渐意识到要去做一些自己的实践，于是经过一个礼拜左右时间的研究学习，通过这样一个仿原神渲染的尝试，对之前卡渲的一些理论做了一下初步的实现。<br>不得不说，“只有实践才能出真知”这句话真的太对了，之前看RTR之类资料的时候觉得这块不过如此，而只有到真正自己上手的时候才明白自己还有太多的东西浮于表面一知半解，包括哪些地方需要什么样的trick，哪里如何优化才能让代码的效率更高，还有最重要的自己定位bug解决bug的能力（别的不说，这甚至还是我第一次buildin转URP….）<br>套用之前看到的图就是这样：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/jpeg/23115229/1651839535848-39172531-673e-41d9-b2ef-b03df653ec18.jpeg#averageHue=%23f9f9f7&amp;clientId=ua34e33ef-0961-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=321&amp;id=u0cfe0f80&amp;originHeight=519&amp;originWidth=640&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=35183&amp;status=error&amp;style=none&amp;taskId=u8a3b84cb-bd4c-413e-b902-c6cdeda017f&amp;title=&amp;width=396" alt="C7DC53DDC05F7F8DF94122B40AAFE510.jpg"><br>我这辈子都搞不懂了…<br>所以就算整体做下来代码量就三四百行，这一个礼拜的学习对我自己而言收获还是挺大的，因此希望通过写这样一篇文章能对我自己的学习过程做一个记录。文章可能不会事无巨细面面俱到，过于拾人牙慧的东西我就直接把链接逐一贴出略过了，而相对的我会留下更多空间去记录自己的思考过程和踩坑经历（如果有哪里理解不到位的话，还请大佬在评论区指正补充）<br><a target="_blank" rel="noopener" href="https://www.zhihu.com/column/c_1215952152252121088">从零开始的卡通渲染</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/360229590">原神角色渲染Shader分析还原</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/435005339">【Unity技术美术】 原神Shader渲染还原解析</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/490406107">从仿原神角色渲染到MMD制作(小记)</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/468209534">从零开始的原神角色渲染</a><br>那么话不多说让我们开始吧！</p>
<h1 id="风格分析"><a href="#风格分析" class="headerlink" title="风格分析"></a>风格分析</h1><h2 id="一些概念"><a href="#一些概念" class="headerlink" title="一些概念"></a>一些概念</h2><p><strong>PBR、NPR与三渲二</strong><br>在喵刀老师去年JTRP教程的<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1AA411A7RR?">20:19</a>处有详细说明，以下进行概括</p>
<blockquote>
<p>卡通渲染属于非真实感渲染（Non-photorealistic rendering，简称NPR）。对应的还有真实感渲染(Photorealistic rendering)。后者旨在渲染真实感的画面，而前者则追求更加有艺术感的画面效果，例如手绘风格的画面</p>
</blockquote>
<p>我们常说的PBR（Physically-based rendering）是一种以现实为参考的渲染方法，而NPR则是与PBR相对的概念，强调风格化，包括但不限于油画，铅笔画，水墨画等不同类型。三渲二属于NPR的一个子集，特指一些用3D手段还原2D赛璐璐风格的技法<br>三渲二的画面特点通常包含以下几点：</p>
<ul>
<li>阴影简单而主观</li>
<li>颜色信息单一，以大色块和硬边过渡为主</li>
<li>主要通过笔触感很强的勾线来凸显形状</li>
<li>特殊的脸部线条画法</li>
<li>条状高光，与光方向无关的边缘光</li>
<li>背光处理（能够大幅提升画面质感）</li>
<li>……</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/23115229/1651846151394-bf7eb62e-ab2b-4ddd-b450-66a3b0df95be.png#averageHue=%23a2a798&amp;clientId=ua34e33ef-0961-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=541&amp;id=ud1094521&amp;originHeight=676&amp;originWidth=1205&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=1005285&amp;status=error&amp;style=none&amp;taskId=ucaf19f42-801f-4883-a17c-5d991962fee&amp;title=&amp;width=964" alt="P5KC{UFS3F8QO%E]_3IUAFV.png"><br>不同风格的三渲二作品<br><strong>赛璐璐，平涂与厚涂</strong><br>赛璐璐和厚涂的区别：<br>赛璐璐：特指一种颜色界限层次分明的上色风格，色块大，图层多，边缘锐利，大量出现在日本动画制作中，属于一种极端的平涂<br>厚涂：运用笔刷和技巧堆砌颜色，技术要求高，画面通常表现出立体感强、色彩丰富、质感厚实的特点</p>
<h2 id="原神的角色渲染"><a href="#原神的角色渲染" class="headerlink" title="原神的角色渲染"></a>原神的角色渲染</h2><p>原神的角色渲染还是有一部分继承了三蹦子的技术的，可以参考<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=egHSE0dpWRw&amp;t">官方古早的视频</a> 12:14-28:01 部分<br>由于能力有限，本次的还原并未涉及游戏内shader的截帧分析，所以说并不是真正意义上的还原，只是在基础的卡通渲染上加了一些自己的想法付诸实现<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/23115229/1651923548730-ddf02e16-237c-465d-b0c0-9b70e5509546.png#averageHue=%23fbfafa&amp;clientId=u32c63bef-2a11-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=558&amp;id=u8cc66437&amp;originHeight=698&amp;originWidth=1087&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=41672&amp;status=error&amp;style=none&amp;taskId=uc8bdea3c-916d-4ce0-9fbb-2c93cb22595&amp;title=&amp;width=869.6" alt="image.png"><br>目前实现的效果：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/gif/23115229/1651921855335-17266abb-c68f-47d1-a4cc-5cb69209973d.gif#averageHue=%2395a5bc&amp;clientId=u32c63bef-2a11-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=384&amp;id=ufa511760&amp;originHeight=480&amp;originWidth=856&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=1425130&amp;status=error&amp;style=none&amp;taskId=u759d9717-1fd2-4f13-a721-21e13401db0&amp;title=&amp;width=684.8" alt="2022.05.07阶段性成果GIF.gif"><br>肉眼可见的一堆问题……不过也只能这样了，期末周精力实在达不到，后续有更改会在这继续更新</p>
<h1 id="贴图分析"><a href="#贴图分析" class="headerlink" title="贴图分析"></a>贴图分析</h1><p>首先还是来看一下我们手上有哪些资源：<br>![B3<code>ITXZ%VD[UHSX(SJ_SV%E.png](https://cdn.nlark.com/yuque/0/2022/png/23115229/1651318026520-15c16f36-39b8-4a63-ad12-ee6c3b568ea2.png#averageHue=%23e6dfdb&amp;clientId=u7629753c-7c10-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=344&amp;id=u14700a1c&amp;originHeight=430&amp;originWidth=746&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=128738&amp;status=error&amp;style=none&amp;taskId=uea7e28db-b597-4b63-8cd4-e08c19a3784&amp;title=&amp;width=596.8)
除了三张Diffuse是官方配布，其他均需要自行获取
Body和Hair分别有一张LightMap（ILM），观察可知其四个通道分别为：
R：高光范围
![Y2N]F)$3E2]XCMCB[[XF8UR.png](https://cdn.nlark.com/yuque/0/2022/png/23115229/1651479545647-d4f2c8ad-8f22-49a3-8ca9-b32ee408c738.png#averageHue=%2392918e&amp;clientId=u161fa7aa-7488-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=390&amp;id=u4476adf6&amp;originHeight=488&amp;originWidth=1400&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=204119&amp;status=error&amp;style=none&amp;taskId=ud0cca84b-35fb-4760-b9e7-d09a0147abe&amp;title=&amp;width=1120)
g：AO Mask（黑色-固定阴影，灰色-动态阴影，白色-完全亮部）
![Z_</code>CW~J]2OV0L9W7O3XMN)K.png](<a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/23115229/1651479550305-7f5c3258-e017-45b6-a210-d1ad69a7a7e9.png#averageHue=%2371706e&amp;clientId=u161fa7aa-7488-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=390&amp;id=uf0c2bd44&amp;originHeight=487&amp;originWidth=1400&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=242700&amp;status=error&amp;style=none&amp;taskId=u8108bb07-f415-477f-8ba2-b092c0c7269&amp;title=&amp;width=1120">https://cdn.nlark.com/yuque/0/2022/png/23115229/1651479550305-7f5c3258-e017-45b6-a210-d1ad69a7a7e9.png#averageHue=%2371706e&amp;clientId=u161fa7aa-7488-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=390&amp;id=uf0c2bd44&amp;originHeight=487&amp;originWidth=1400&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=242700&amp;status=error&amp;style=none&amp;taskId=u8108bb07-f415-477f-8ba2-b092c0c7269&amp;title=&amp;width=1120</a>)<br>b：高光强度<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/23115229/1651479554404-c54d26d2-6763-4faa-926e-fc397c434d3f.png#averageHue=%2373716f&amp;clientId=u161fa7aa-7488-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=390&amp;id=uc105c6a8&amp;originHeight=488&amp;originWidth=1400&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=207626&amp;status=error&amp;style=none&amp;taskId=u69821579-129d-4a24-9326-95d986ae6fd&amp;title=&amp;width=1120" alt="%IZF}8KPNW$P@`M19U)W}CS.png"><br>a：Ramp阈值<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/23115229/1651319516359-1b6c8bd5-ac3a-4d1b-b58b-64f6b8d94fb3.png#averageHue=%23464544&amp;clientId=u7629753c-7c10-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=822&amp;id=u3d07533b&amp;originHeight=1028&amp;originWidth=1916&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=155059&amp;status=error&amp;style=none&amp;taskId=u300fe855-a98b-4372-b0c3-164e0c398a3&amp;title=&amp;width=1532.8" alt="`S[)1911T$~[%L_F2_IJRKN.png](https://cdn.nlark.com/yuque/0/2022/png/23115229/1651479558991-51b1bafb-2b62-4651-914a-503a43517149.png#averageHue=%2373716e&amp;clientId=u161fa7aa-7488-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=390&amp;id=u1405a4d5&amp;originHeight=488&amp;originWidth=1397&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=184386&amp;status=error&amp;style=none&amp;taskId=u196b5529-2088-462c-934d-83cb7970079&amp;title=&amp;width=1117.6)
身体和头发分别对应两张Ramp图，每张ramp都分了冷色调和暖色调的渐变条带，有点像UE的Curve Atlas
![K2}FGB3QNM~%52~TCHO8F5W.png](https://cdn.nlark.com/yuque/0/2022/png/23115229/1651319433368-28678456-7f62-4400-8b4a-f6c123931092.png#averageHue=%23444342&amp;clientId=u7629753c-7c10-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=822&amp;id=u656bc558&amp;originHeight=1027&amp;originWidth=1917&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=156316&amp;status=error&amp;style=none&amp;taskId=uab1301bd-4d2c-4ee9-ad2f-b3247bce2bc&amp;title=&amp;width=1533.6)
![B`E$YE@LDE]R]%XG)VZB$3N.png"><br>不同角色的ramp的排列方式和条带数量都是有区别的，比如甘雨这套，body一共5种渐变色，hair有4种，而对于排列方式则大概分为两种，一种是256<em>16，暖8冷8（大概率有3像素以上的留白），另一种是20像素的，暖5</em>2 冷5*2，所以需要根据不同类型选择不同的采样方式，这个后面还会详细说到（或者可以直接使用曲线进行手动调色，自由度更高）<br>两种不同的ramp：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/23115229/1651399873348-5740d8b7-28ea-4577-8c16-75a32fd2d7af.png#averageHue=%23edc5ba&amp;clientId=u161fa7aa-7488-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=295&amp;id=u626720d9&amp;originHeight=504&amp;originWidth=348&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=4801&amp;status=error&amp;style=none&amp;taskId=ua571be27-aecf-404e-8b18-022ee87aceb&amp;title=&amp;width=203.39999389648438" alt="Z5F%3HMBS73GAKH28H_DOYL.png"></th>
<th><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/23115229/1651399871157-1da1e910-e5e6-42c6-92ef-d538a70c965c.png#averageHue=%23726c79&amp;clientId=u161fa7aa-7488-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=293&amp;id=u29510ad8&amp;originHeight=408&amp;originWidth=283&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=3687&amp;status=error&amp;style=none&amp;taskId=u87a85abc-3a31-4d9c-8f8b-72cf11c461f&amp;title=&amp;width=203.40000915527344" alt="UT)O]9L3}LD%G$)BU2DDZA5.png"></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>剩下还有两张，一张脸部SDF还有一张MetalMap，在做脸部阴影和身体身体金属部件高光的时候都会起到特殊的作用，也是等到后面提到了再说吧<br>关于贴图设置，除了Diffuse图和Ramp图，其他全部取消勾选sRGB，法线图（如果有的话）纹理类型选择Normal Map，SDF纹理压缩设置为None（UE改成灰阶），不然会有很难看的锯齿<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/23115229/1665816267313-38100aaa-cbf3-44d2-b455-86e6356b82aa.png#averageHue=%23393737&amp;clientId=u8171bcba-2b22-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=410&amp;id=u8ec54953&amp;originHeight=456&amp;originWidth=360&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=67817&amp;status=error&amp;style=none&amp;taskId=ua54cd393-5b7f-49d6-ab66-7b705fd2638&amp;title=&amp;width=324" alt="RM`B1{(Y0J51REWIN@R`@@A.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/23115229/1665816310467-2520ae9f-0b8f-40fc-929f-89e1c494b19a.png#averageHue=%23272626&amp;clientId=u8171bcba-2b22-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=410&amp;id=u7a5fd35b&amp;originHeight=558&amp;originWidth=472&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=36726&amp;status=error&amp;style=none&amp;taskId=u8d1fd4fa-5f9f-4658-bee4-1ec45c74819&amp;title=&amp;width=347" alt="(6O{`_13IR61NCSLR~8854A.png"></p>
<h1 id="描边"><a href="#描边" class="headerlink" title="描边"></a>描边</h1><p>那么现在就让我们开始正式的代码编写。<br>首先来看描边。描边通常是卡通角色渲染中拿到模型后第一件需要处理的事情，一方面是因为它极其基础，另一方面也是因为它有可能会影响后续其他效果的调整（如边缘光的粗细），这里虽然采用的还是传统的背面法线外扩的方式，但是我有对其中几个经典的问题进行了改进，如下：</p>
<ul>
<li>描边粗细随摄像机远近发生变化</li>
<li>硬表面描边断裂</li>
<li>视口比例修正</li>
</ul>
<p>第一个问题是因为，我们一般的法线外扩都是在视口空间完成的，最终渲染到屏幕之前，硬件底层还会帮我们做一步透视除法（即除w将坐标映射到$[-1,1]$的NDC空间），要想保持描边粗细不变，我们就必须在外扩距离的基础上乘上w来消除它的影响<br>第二个问题也老生常谈了，问题出在模型本身的法线都是垂直于当三角网格所在平面的，一个顶点可能会依据邻接的三角面选择多个法线方向，而法线外扩通常在顶点着色器就完成了全部的处理，那么这时候就需要我们提前对模型进行法线上的合并。详细的做法可以参考喵刀老师的文章：<br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/107664564">【Job/Toon Shading Workflow】自动生成硬表面模型Outline Normal</a><br>有几个小点需要注意的是，文中提到的 JOBS 是引擎基于ECS的一套多线程管理系统，需要提前在Package Manager中进行环境的配置，这里建议直接向manifest.json文件中添加”com.unity.collections”: “0.17.0-preview.18”，以安装相关插件，因为entity在直接安装的过程中很有可能发生版本不兼容等各种问题，我在这上面折腾了好久，最后还是google找到了适合自己的解决方案……<br>喵刀老师的这个方法的话，是通过在模型导入的时候直接生成一个副本然后做模型后处理实现的，相比2173大佬的那个将平滑法线写入模型切线的编辑器工具，这个可以在引擎关闭时仍保留平滑法线的数据，方便了很多（当然也可以直接在dcc里写工具，只要能解决问题就行）<br>如果用的是喵刀老师的方法，需要注意一下顶点色通道的问题，因为官方给的模型的g通道原来用来控制Ramp偏移的，所以要避免这个问题，要么就用第二套顶点色，要么后面再自己开个参数手动控制偏移，不论哪种方法都造不成什么大问题<br>平滑法线输出如图，绿色代表左上，黄色代表右上，黑色左下，红色右下：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/23115229/1651978474518-7ba1429f-9594-4567-8973-74733ba6dcd9.png#averageHue=%237d7d7d&amp;clientId=u357d18e8-45ea-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=431&amp;id=u46d1b954&amp;originHeight=865&amp;originWidth=812&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=196162&amp;status=error&amp;style=none&amp;taskId=u6b0d38af-3ef5-48a3-915c-c94881d26a4&amp;title=&amp;width=404.6000061035156" alt="C8`[`2K`@Z3OJTRAFKASM5E.png](https://cdn.nlark.com/yuque/0/2022/png/23115229/1651323197568-a1ea7dba-bbce-4d39-9747-5cccc51c447d.png#averageHue=%233f6eb5&amp;clientId=u7c9f8c6b-ad1f-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=313&amp;id=z9O3Q&amp;originHeight=391&amp;originWidth=849&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=81770&amp;status=error&amp;style=none&amp;taskId=u3869abc3-074f-4136-b08f-b9f90e88dcc&amp;title=&amp;width=679.2)
最后一个问题，视口比例修正，这个就很简单了，直接拿参数算一下乘上去就好
片元着色器部分代码如下：
<figure class=" highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取预先烘焙进顶点色的切线空间平滑法线，修复描边断裂，同时避免蒙皮动画可能发生的错误描边</span></span><br><span class="line"><span class="comment">// UnpackNormalmapRGorAG会自动将RG变为AG，也就将顶点色控制描边粗细变化一并实现了</span></span><br><span class="line">half3 smoothNormal = <span class="built_in">normalize</span>(UnpackNormalmapRGorAG(v.color));</span><br><span class="line"><span class="comment">// 将法线从切线空间变换到世界空间</span></span><br><span class="line">float3x3 tangentTransform = float3x3(o.worldTangent, o.worldBiTangent, o.worldNormal);</span><br><span class="line">half3 worldOutlineNormal = <span class="built_in">normalize</span>(mul(smoothNormal, tangentTransform));</span><br><span class="line"><span class="comment">// 再从世界空间变换到裁剪空间，此处 * pos.w 是为了消除齐次除法的影响，使得在摄像机远近发生变化时，描边粗细保持不变</span></span><br><span class="line">half3 outlineNormal = TransformWorldToHClip(worldOutlineNormal) * pos.w;</span><br><span class="line"><span class="comment">// 求得屏幕宽高比，修正描边以适配窗口</span></span><br><span class="line"><span class="type">float</span> aspect = _ScreenParams.x / _ScreenParams.y;</span><br><span class="line">pos.xy += <span class="number">0.001</span> * _OutlineWidth * v.color.a * outlineNormal.xy * aspect * _EnableOutline;</span><br><span class="line">o.pos = pos;</span><br></pre></td></tr></table>
效果：
![M9TBJWGQ2[Q5R47ZTCLE[H1.png](https://cdn.nlark.com/yuque/0/2022/png/23115229/1651978398152-7c4ed2e8-d11b-410c-9179-626329d268d6.png#averageHue=%237b7b7a&amp;clientId=u357d18e8-45ea-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=421&amp;id=u16667bd3&amp;originHeight=834&amp;originWidth=753&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=173569&amp;status=error&amp;style=none&amp;taskId=u82cf9603-85f7-4c1b-8aab-276af66a698&amp;title=&amp;width=380.3999938964844)
不处理
![2YB$3YCNXNO$KMB`{FN~26O.png](https://cdn.nlark.com/yuque/0/2022/png/23115229/1651929637268-d5106fd2-3dc5-475a-8ecd-e5f21dd53b06.png#averageHue=%237d7d7d&amp;clientId=u32c63bef-2a11-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=413&amp;id=u24f47a4e&amp;originHeight=1198&amp;originWidth=1115&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=300940&amp;status=error&amp;style=none&amp;taskId=uf654991f-6f9a-4570-b098-c0743aaee7c&amp;title=&amp;width=384)
模型后处理
![%A5I[(@V6[8}Q_4$7](`3KG.png"><br>存进切线<br>可以看到平滑后还是有点效果的（再想把质量往上提的话就直接用p+吧hhh）<br>2021.05.08：<br>今天早上爬起来看了眼JTRP的Readme，里面中说平滑法线的这个流程已经失效了，但我2021.3.1f1c1 collection0.17.0-preview.18这个版本还可以用，应该就是包版本的问题</p>
<h1 id="Ramp"><a href="#Ramp" class="headerlink" title="Ramp"></a>Ramp</h1><p>接下来轮到漫反射<br>在常规的卡通渲染当中，一般都会通过冷暖色调分离、阴影边缘硬化等手段来使画面达到风格化的目的，而原神这种用ilm贴图配合ramp实现色调控制的方法，也是早在好几年前《GUILTY GEAR Xrd》就已经存在的思路。值得一提的是，三蹦子的ramp和原神这套虽然原理差不多，但有些地方还是有一定差别的（虽然不管怎么样最后都会有一定trick,,,）<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/23115229/1651930115093-1246103f-0d0c-46c0-afb5-525f99f85602.png#averageHue=%237a756d&amp;clientId=u32c63bef-2a11-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;id=u4dfc96ee&amp;originHeight=217&amp;originWidth=800&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=error&amp;style=none&amp;taskId=u6db61e8b-8641-4a8f-86c5-03b065a4d01&amp;title=" alt><br>这里我就主要说一下甘雨的ramp图采样思路吧（不适用其他角色）<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/23115229/1651480682206-a0971767-97c6-4c54-9296-0ce38b0d4c44.png#averageHue=%23185328&amp;clientId=udf4b8113-e78b-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=472&amp;id=ubc1bf4ee&amp;originHeight=590&amp;originWidth=1147&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=44172&amp;status=error&amp;style=none&amp;taskId=u88364dfb-142d-414a-9b44-14e6719e84e&amp;title=&amp;width=917.6" alt="GKX2HTD8~IN3EB6$N5ICVSX.png"><br>经过上面的贴图分析我们知道，我们采样的像素分为冷暖两种色调，以适应白天和夜晚不同的光线环境（实际上游戏里还有不同天气等诸多别的影响，不知道是用额外的ramp还是后处理实现的），那么我们要做的就是通过shader_feature来进行采样的切换。具体的采样方法上面这张图已经表示的非常清楚了，为了尽可能的采样到像素中间，以避免颜色的混杂，必须对采样方式实行精确的控制。这里有一点比较迷惑的是，甘雨LightMap的a通道看上去只分了三层，但是ramp却给了五个色带，多出来的那几个色带没看懂是用来干嘛的，所以我最后直接让lightmap自己选去了（将0-1灰度映射到1-5代入等差数列…），最后看起来也没什么太大的问题….<br>对于头发部分，因为头发部分只有4个色带，所以映射关系就是0-1到1-4，然后根据ps中观察到的渐变形态，主观的采样了第一和第三条，也不一定是正确答案<br>有了RampY，剩下的就简单了，RampX根据原来的lambert值，做smoothstep重映射，只保留0到一定数值的渐变，而大于这一数值的全部采样ramp最右边的颜色，这样一来就既可以保留阴影色的过渡，又可以形成硬边，将明暗很好的区分开来<br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/157758600">Shader实验室: smoothstep函数</a><br><a target="_blank" rel="noopener" href="https://www.geogebra.org/classic/sw9mtpdd">GeoGebra Classic - GeoGebra</a><br>最后乘上AO和基础色，Ramp部分就基本完成了<br>ramp图第一行<br>代码：<br><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">half4 ToonPassFrag(v2f i) : SV_TARGET</span><br><span class="line">&#123;</span><br><span class="line">    float4 BaseColor = SAMPLE_TEXTURE2D(_MainTex, sampler_MainTex, i.uv) * _MainColor;</span><br><span class="line">    float4 LightMapColor = SAMPLE_TEXTURE2D(_LightMap, sampler_LightMap, i.uv);</span><br><span class="line">    Light mainLight = GetMainLight();</span><br><span class="line">    half4 LightColor = half4(mainLight.color, <span class="number">1.0</span>);</span><br><span class="line">    half3 lightDir = <span class="built_in">normalize</span>(mainLight.direction);</span><br><span class="line">    half3 viewDir = <span class="built_in">normalize</span>(_WorldSpaceCameraPos - i.worldPos);</span><br><span class="line">    half3 halfDir = <span class="built_in">normalize</span>(viewDir + lightDir);</span><br><span class="line"></span><br><span class="line">    half halfLambert = <span class="built_in">dot</span>(lightDir, i.worldNormal) * <span class="number">0.5</span> + <span class="number">0.5</span>;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Base Ramp</span></span><br><span class="line">    <span class="comment">// 依据原来的lambert值，保留0到一定数值的smooth渐变，大于这一数值的全部采样ramp最右边的颜色，从而形成硬边</span></span><br><span class="line">    halfLambert = <span class="built_in">smoothstep</span>(<span class="number">0.0</span>, _ShadowSmooth, halfLambert);</span><br><span class="line">    <span class="comment">// 常暗阴影</span></span><br><span class="line">    <span class="type">float</span> ShadowAO = <span class="built_in">smoothstep</span>(<span class="number">0.1</span>, LightMapColor.g, <span class="number">0.7</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> RampPixelX = <span class="number">0.00390625</span>;  <span class="comment">//0.00390625 = 1/256</span></span><br><span class="line">    <span class="type">float</span> RampPixelY = <span class="number">0.03125</span>;     <span class="comment">//0.03125 = 1/16/2   尽量采样到ramp条带的正中间，以避免精度误差</span></span><br><span class="line">    <span class="type">float</span> RampX, RampY;</span><br><span class="line">    <span class="comment">// 对X做一步Clamp，防止采样到边界</span></span><br><span class="line">    RampX = <span class="built_in">clamp</span>(halfLambert*ShadowAO, RampPixelX, <span class="number">1</span>-RampPixelX);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 灰度0.0-0.2  硬Ramp</span></span><br><span class="line">    <span class="comment">// 灰度0.2-0.4  软Ramp</span></span><br><span class="line">    <span class="comment">// 灰度0.4-0.6  金属层</span></span><br><span class="line">    <span class="comment">// 灰度0.6-0.8  布料层，主要为silk类</span></span><br><span class="line">    <span class="comment">// 灰度0.8-1.0  皮肤/头发层</span></span><br><span class="line">    <span class="comment">// 白天采样上半，晚上采样下半</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//— — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</span></span><br><span class="line">    <span class="comment">// Base Ramp</span></span><br><span class="line">    <span class="keyword">if</span> (_IsNight == <span class="number">0.0</span>)</span><br><span class="line">        RampY = RampPixelY * (<span class="number">33</span> - <span class="number">2</span> * (LightMapColor.a * <span class="number">4</span> + <span class="number">1</span>));</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        RampY = RampPixelY * (<span class="number">17</span> - <span class="number">2</span> * (LightMapColor.a * <span class="number">4</span> + <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">    float2 RampUV = float2(RampX, RampY);</span><br><span class="line">    float4 rampColor = SAMPLE_TEXTURE2D(_RampMap, sampler_RampMap, RampUV);</span><br><span class="line">    half4 FinalRamp = lerp(rampColor * BaseColor * _ShadowColor, BaseColor, <span class="built_in">step</span>(_RampShadowRange, halfLambert * ShadowAO));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//— — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</span></span><br><span class="line">    <span class="comment">// Hair Ramp</span></span><br><span class="line">    <span class="meta">#if _SHADERENUM_HAIR</span></span><br><span class="line">        <span class="keyword">if</span> (_IsNight == <span class="number">0.0</span>)</span><br><span class="line">            RampY = RampPixelY * (<span class="number">33</span> - <span class="number">2</span> * lerp(<span class="number">1</span>, <span class="number">3</span>, <span class="built_in">step</span>(<span class="number">0.5</span>, LightMapColor.a)));</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            RampY = RampPixelY * (<span class="number">17</span> - <span class="number">2</span> * lerp(<span class="number">1</span>, <span class="number">3</span>, <span class="built_in">step</span>(<span class="number">0.5</span>, LightMapColor.a)));</span><br><span class="line">        RampUV = float2(RampX, RampY);</span><br><span class="line">        rampColor = SAMPLE_TEXTURE2D(_RampMap, sampler_RampMap, RampUV);</span><br><span class="line">        FinalRamp = lerp(rampColor * BaseColor * _ShadowColor, BaseColor, <span class="built_in">step</span>(_RampShadowRange, halfLambert * ShadowAO));</span><br><span class="line">    <span class="meta">#endif</span></span><br><span class="line">    <span class="keyword">return</span> FinalRamp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>效果：<br>![ZI398D)TP5PM$62<a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/23115229/1651941704059-c5b9d628-9546-4565-929a-ac9256f98fc0.png#averageHue=%23827d75&amp;clientId=u32c63bef-2a11-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=431&amp;id=ub864a92a&amp;originHeight=1186&amp;originWidth=1094&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=639886&amp;status=error&amp;style=none&amp;taskId=ue435b9e1-c006-429e-867d-ba70a989ae0&amp;title=&amp;width=398">L%0O$Y5.png</a></p>
<h1 id="SDF脸部阴影"><a href="#SDF脸部阴影" class="headerlink" title="SDF脸部阴影"></a>SDF脸部阴影</h1><p>SDF这一块其实没啥好说的，相关的学习资料有很多，实现的过程也非常简单（虽然我被各种向量点乘绕了好久hhh）大概的原理是用一张黑白高度图作为阴影阈值，与Front向量和Light向量的点积做比较，从而精确地控制光线在不同角度下脸部的阴影形状。采用这种方法，可以很好的代替原先修正面部法线的复杂流程，轻松达到平滑面部阴影过渡的效果<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/23115229/1651987091496-58b9a171-9c02-40a4-ab8d-cdcce967bca6.png#averageHue=%2378806e&amp;clientId=u357d18e8-45ea-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=244&amp;id=udbc09483&amp;originHeight=612&amp;originWidth=796&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=501190&amp;status=error&amp;style=none&amp;taskId=udb7df1b5-254f-43ed-bd30-477955a5e3c&amp;title=&amp;width=318" alt="image.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/23115229/1651987115690-7d1f8129-d298-4fec-9630-86e5a085bbb8.png#averageHue=%23494852&amp;clientId=u357d18e8-45ea-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=361&amp;id=u8fa26799&amp;originHeight=451&amp;originWidth=300&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=116751&amp;status=error&amp;style=none&amp;taskId=u50759dd5-e8e6-4c45-bf00-9917b974afd&amp;title=&amp;width=240" alt="H8{J97U1(C`PMHV]N$Q2{3B.png"><br>   伦勃朗光<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/23115229/1651976175303-456ffa3e-9325-495b-81ca-c38962587212.png#averageHue=%238a97c4&amp;clientId=u32c63bef-2a11-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=154&amp;id=u851f4f84&amp;originHeight=192&amp;originWidth=222&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=80309&amp;status=error&amp;style=none&amp;taskId=ufcd4b50e-b0ce-418a-b2ef-ad82e8f1128&amp;title=&amp;width=177.6" alt="K)WFF8Y@}6IE{)C2QH8H{W7.png">             <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/23115229/1651986423484-b8969508-6808-4843-a1de-e39ec32854bc.png#averageHue=%23b9a5d5&amp;clientId=u357d18e8-45ea-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=153&amp;id=ub020cd91&amp;originHeight=408&amp;originWidth=434&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=249483&amp;status=error&amp;style=none&amp;taskId=u64935fbf-4937-4c53-9fa1-80b7e9e16c5&amp;title=&amp;width=163.1999969482422" alt="image.png"><br>不用之前                                                  用了之后<br>立竿见影！</p>
<h2 id="资产生成"><a href="#资产生成" class="headerlink" title="资产生成"></a>资产生成</h2><p>因为学校数字图像处理课期末大作业的缘故，我对这方面进行了比较详细的研究。一共分为两种方法，一种靠SDF程序化生成，另一种直接在csp或ps用等高线画。其中后者不会在此详细说明，详情可以参考如下教程<br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV16y4y1x7J1?">【教程】使用csp等高线填充工具制作三渲二面部阴影贴图_哔哩哔哩_bilibili</a><br>这里就简单配合几张图说下SDF做这张贴图怎么做</p>
<h3 id="8ssedt"><a href="#8ssedt" class="headerlink" title="8ssedt"></a>8ssedt</h3><p>有关什么是SDF可以去看看GAMES202 p5，或者直接看我笔记上实时阴影的部分，简单来说，它就是通过一个场定义出了平面或空间中每个点距其最近物体的最短距离，其中，S虽然翻译过来是有向（signed），但实际上它是一个标量场，只不过通过正负号标识出了物体的内外而已<br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/464408139">GAMES202高质量实时渲染-个人笔记：实时阴影</a><br>在这里，SDF的主要应用体现在几何形变上<br>关于SDF图的生成有一种交8ssedt的算法，主要用到了动态规划的思想<br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/337944099">Signed Distance Field</a><br>可运行程序：<br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/356185096">如何快速生成混合卡通光照图</a><br>整个过程分成了两个grid来做，每个grid有2个pass，一趟做下来会进八次循环……<br>我配合着做了几张动图，可能会比较好理解一点：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/gif/23115229/1651982961735-a28193ec-9f6a-4f8a-b6f5-7e57e55ba2fa.gif#averageHue=%23e3e2e2&amp;clientId=u357d18e8-45ea-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=804&amp;id=u73f09072&amp;originHeight=1005&amp;originWidth=977&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=1197566&amp;status=error&amp;style=none&amp;taskId=u706ea2f2-a7a6-4473-bfcb-72734202e31&amp;title=&amp;width=781.6" alt="pass1_gif.gif"><br>第二个Pass大差不差：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/gif/23115229/1651989081551-cc28d698-8029-44fb-9bdd-949fb06c9a2e.gif#averageHue=%23e3e0e0&amp;clientId=u357d18e8-45ea-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=804&amp;id=u7031a37a&amp;originHeight=1005&amp;originWidth=977&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=403144&amp;status=error&amp;style=none&amp;taskId=u6ab32609-6e3e-4cda-a2b2-e6d8bd4b4bc&amp;title=&amp;width=781.6" alt="pass2_gif.gif"><br>算法优化：<br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/58271568781d">记一次代码优化(C++)</a></p>
<h3 id="二值图融合"><a href="#二值图融合" class="headerlink" title="二值图融合"></a>二值图融合</h3><p>到这里，有些人可能还不是很清楚我们要干嘛。其实我们最终的目的很简单，就是将下面这几张二值图融合起来，而融合的参照，或者说插值所要用到的权重，就是我们上面生成的SDF<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/23115229/1651985366801-4798909a-16fb-40fe-88a8-920738265dfd.png#averageHue=%23a4a3a3&amp;clientId=u357d18e8-45ea-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;id=u6056f2ce&amp;originHeight=168&amp;originWidth=1090&amp;originalType=url&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=26217&amp;status=error&amp;style=none&amp;taskId=u03e07cb1-00ac-42c8-9615-b022403e943&amp;title=" alt="image.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/23115229/1651989678888-7d41bb27-2539-4043-8c6c-838a3c4bb181.png#averageHue=%232e2323&amp;clientId=u357d18e8-45ea-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=509&amp;id=u02b4da07&amp;originHeight=636&amp;originWidth=748&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=102251&amp;status=error&amp;style=none&amp;taskId=ufd184701-ace7-409e-9dd0-89dafe7753d&amp;title=&amp;width=598.4" alt="blend.png"><br>试图解释…<br>还是直接上代码吧：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> scale = <span class="number">1.f</span> / (images.<span class="built_in">size</span>() - <span class="number">1</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> step = <span class="number">0</span>, i = images.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">1</span>; --i, ++step)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> y = <span class="number">0</span>; y &lt; imageHeight; ++y)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">0</span>; x &lt; imageWidth; ++x)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// lerp</span></span><br><span class="line">            <span class="type">int</span> sdf_index = y * imageWidth + x;</span><br><span class="line">            <span class="type">int</span> pixel_index = sdf_index * imageChannel;</span><br><span class="line">            </span><br><span class="line">            <span class="type">int</span> left_border_index = i;</span><br><span class="line">            <span class="type">int</span> right_border_index = i - <span class="number">1</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="type">float</span> sdf1 = images[left_border_index]-&gt;sdf[sdf_index] / <span class="number">255.f</span>;</span><br><span class="line">            <span class="type">float</span> sdf2 = images[right_border_index]-&gt;sdf[sdf_index] / <span class="number">255.f</span>;</span><br><span class="line">            sdf1 = <span class="number">2.f</span> * sdf1 - <span class="number">1.f</span>;</span><br><span class="line">            sdf2 = <span class="number">2.f</span> * sdf2 - <span class="number">1.f</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="type">float</span> left = step * scale;</span><br><span class="line">            <span class="type">float</span> right = (step + <span class="number">1</span>) * scale;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (sdf1 * sdf2 &gt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (right_border_index == <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (sdf1 &lt; <span class="number">0</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="type">int</span> c = <span class="number">0</span>; c &lt; imageChannel; ++c)</span><br><span class="line">                            image[pixel_index + c] = <span class="number">255</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// nothing</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// sdf1 &lt; 0 , sdf2 &gt; 0</span></span><br><span class="line">                <span class="type">float</span> totalDis = <span class="built_in">abs</span>(sdf1) + <span class="built_in">abs</span>(sdf2);</span><br><span class="line">                <span class="type">float</span> t = <span class="built_in">abs</span>(sdf2) / totalDis;</span><br><span class="line">                t = <span class="number">1</span> - t;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> c = <span class="number">0</span>; c &lt; imageChannel; ++c)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">float</span> dst = left * (<span class="number">1</span> - t) + (right * t);</span><br><span class="line">                    <span class="comment">// dst = std::pow(dst, 1 / 2.2f); // gamma for linear display</span></span><br><span class="line">                    image[pixel_index + c] = dst * <span class="number">255</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>看不懂可以去看下面这篇的后半部分<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qjh5606/article/details/119958786">图形学基础|基于SDF的卡通阴影图_桑来93的博客-CSDN博客_sdf图</a></p>
<h2 id="使用贴图"><a href="#使用贴图" class="headerlink" title="使用贴图"></a>使用贴图</h2><p>最后终于到怎么使用阴影图了，老样子我还是把我参考的文章放在前面<br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/279334552">神作面部阴影渲染还原</a><br>核心代码就一行：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="built_in">lerp</span>(BaseColor, ShadowColor, <span class="built_in">step</span>(FaceMap.r, <span class="number">1</span>-FdotL));</span><br></pre></td></tr></table></figure><br>一开始当 FdotL=0 时，脸上开始出现被照亮的区域，随着F和L的夹角减小，FdotL增大，1-FdotL减小，脸上越来越多的区域被判断为亮面，直到 FdotL=1 完全受光<br>在这之后，灯光向量通过RdotL=0的临界点，贴图UV进行一次翻转，以完全相反的过程重复一遍采样，即1-FdotL增大，阴影面积相应增加<br>伪代码如下：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (RdotL &lt; <span class="number">0</span>)</span><br><span class="line">	FaceMap = FaceMap;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	FaceMap = FaceMapInverse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (FaceMap.r &gt; <span class="number">1</span>-FdotL)</span><br><span class="line">    <span class="keyword">return</span> BaseColor;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> ShadowColor;</span><br></pre></td></tr></table></figure><br>画了一张图描述这个过程，长下面这样：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/23115229/1651990428473-0f1604ee-cf57-4f8d-a3c5-08daa0fa8761.png#averageHue=%23eae9e9&amp;clientId=u357d18e8-45ea-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=394&amp;id=ua26cb363&amp;originHeight=492&amp;originWidth=1182&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=55257&amp;status=error&amp;style=none&amp;taskId=ub1dd3717-663d-42dd-897f-a9bf7526616&amp;title=&amp;width=945.6" alt="V%FB%610S$])5KSHM~WVQ4P.png"><br>到这一步，我们的效果就基本已经完成了，下面强调几个注意点<br>第一，贴图翻转是对UV进行水平翻转，不能在采样结果上做1-x运算，即：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> FaceMap = <span class="built_in">lerp</span>(LightMapColor.r, <span class="number">1</span>-LightMapColor.r, <span class="built_in">step</span>(<span class="number">0</span>, RdotL)) * <span class="built_in">step</span>(<span class="number">0</span>, FdotL);</span><br></pre></td></tr></table></figure><br>第二，出现头发阴影与脸部阴影对不上的问题的时候，不能直接在采样数据上±Offset，会导致阴影跳变，解决方案是像雪羽大佬那样，构建一个旋转矩阵对灯管向量进行偏移<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> sinx = <span class="built_in">sin</span>(_FaceShadowOffset);</span><br><span class="line"><span class="type">float</span> cosx = <span class="built_in">cos</span>(_FaceShadowOffset);</span><br><span class="line">float2x2 rotationOffset1 = <span class="built_in">float2x2</span>(cosx, sinx, -sinx, cosx); <span class="comment">//顺时针偏移</span></span><br><span class="line">float2x2 rotationOffset2 = <span class="built_in">float2x2</span>(cosx, -sinx, sinx, cosx); <span class="comment">//逆时针偏移</span></span><br><span class="line">float2 FaceLightDir = <span class="built_in">lerp</span>(<span class="built_in">mul</span>(rotationOffset1, lightDir.xz), <span class="built_in">mul</span>(rotationOffset2, lightDir.xz), <span class="built_in">step</span>(<span class="number">0</span>, RdotL));</span><br></pre></td></tr></table></figure><br>第三，编写完代码之后通常会发现阴影会出现很难看的锯齿，这时候需要回到编辑器将贴图mipmap关掉，并将其类型设置为shadowmask<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/23115229/1651994895584-4d2b7677-87d5-44fa-8db5-0c0f727c3f71.png#averageHue=%234f4c4b&amp;clientId=u357d18e8-45ea-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=821&amp;id=u86b28548&amp;originHeight=1026&amp;originWidth=1921&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=838342&amp;status=error&amp;style=none&amp;taskId=u397a7a63-4808-40b9-98db-88e9f591333&amp;title=&amp;width=1536.8" alt="Z~%6V2}%MYHR{WV]1M88NJH.png"><br>大功告成！（完整代码在文章末尾）</p>
<h1 id="高光"><a href="#高光" class="headerlink" title="高光"></a>高光</h1><p>高光这里大量借鉴了清清的做法（链接在上面），分成了step高光，blinn-phong和matcap金属高光，不过目前好像在最后混合的时候出了点问题，以后有机会修一修吧（必须修！）<br>头发的高光也没特别细调，只是把blinn-phong和metal全关了稍微调了调裁边视角光，后面打算把各向异性也加上，期末周了真的顾不上……<br>代码（没什么借鉴意义）：<br><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 高光</span></span><br><span class="line">half4 BlinnPhongSpecular;</span><br><span class="line">half4 MetalSpecular;</span><br><span class="line">half4 StepSpecular;</span><br><span class="line">half4 FinalSpecular;</span><br><span class="line"><span class="comment">// ILM的R通道，灰色为裁边视角高光</span></span><br><span class="line">half StepMask = <span class="built_in">step</span>(<span class="number">0.2</span>, LightMapColor.r) - <span class="built_in">step</span>(<span class="number">0.8</span>, LightMapColor.r);</span><br><span class="line">StepSpecular = <span class="built_in">step</span>(<span class="number">1</span> - _StepSpecularGloss, saturate(<span class="built_in">dot</span>(i.worldNormal, viewDir))) * _StepSpecularIntensity * StepMask;</span><br><span class="line"><span class="comment">// ILM的R通道，白色为 Blinn-Phong + 金属高光</span></span><br><span class="line">half MetalMask = <span class="built_in">step</span>(<span class="number">0.9</span>, LightMapColor.r);</span><br><span class="line"><span class="comment">// Blinn-Phong</span></span><br><span class="line">BlinnPhongSpecular = <span class="built_in">pow</span>(<span class="built_in">max</span>(<span class="number">0</span>, <span class="built_in">dot</span>(i.worldNormal, halfDir)), _BlinnPhongSpecularGloss) * _BlinnPhongSpecularIntensity * MetalMask;</span><br><span class="line"><span class="comment">// 金属高光</span></span><br><span class="line">float2 MetalMapUV = mul((float3x3) UNITY_MATRIX_V, i.worldNormal).xy * <span class="number">0.5</span> + <span class="number">0.5</span>;</span><br><span class="line"><span class="type">float</span> MetalMap = SAMPLE_TEXTURE2D(_MetalMap, sampler_MetalMap, MetalMapUV).r;</span><br><span class="line">MetalMap = <span class="built_in">step</span>(_MetalSpecularGloss, MetalMap);</span><br><span class="line">MetalSpecular = MetalMap * _MetalSpecularIntensity * MetalMask;</span><br><span class="line">                </span><br><span class="line">FinalSpecular = StepSpecular + BlinnPhongSpecular + MetalSpecular;</span><br><span class="line">FinalSpecular = lerp(<span class="number">0</span>, BaseColor * FinalSpecular * _SpecularColor, LightMapColor.b) ;</span><br><span class="line">FinalSpecular *= halfLambert * ShadowAO * _EnableSpecular;</span><br></pre></td></tr></table></figure><br>效果：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/23115229/1651942862523-38ec19a2-9cac-44d7-a766-e7f7c0261b91.png#averageHue=%23a0c5d1&amp;clientId=u32c63bef-2a11-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=280&amp;id=udb83753a&amp;originHeight=421&amp;originWidth=559&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=316632&amp;status=error&amp;style=none&amp;taskId=u9c6397b3-40a5-4e61-8e12-dcc1dbfeb84&amp;title=&amp;width=372" alt="I5`S)JPI%`74U[M$J5I1`SB.png](https://cdn.nlark.com/yuque/0/2022/png/23115229/1651942798102-7e676721-91dd-4fdc-ace7-276e24029f92.png#averageHue=%23817d75&amp;clientId=u32c63bef-2a11-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=337&amp;id=u6f53203a&amp;originHeight=819&amp;originWidth=857&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=426443&amp;status=error&amp;style=none&amp;taskId=u424e449b-19d2-426c-9fc9-c43ef50661f&amp;title=&amp;width=352.6000061035156)
![OF4G]%7__70EWC%Z4GFVVAC.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/23115229/1651942892590-d027cd81-6609-4575-872f-b44e798a520d.png#averageHue=%239fc6d2&amp;clientId=u32c63bef-2a11-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=250&amp;id=ua20fab94&amp;originHeight=478&amp;originWidth=703&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=419152&amp;status=error&amp;style=none&amp;taskId=ud911ff1b-cf73-4d2e-a109-13e35dab84b&amp;title=&amp;width=367.3999938964844" alt="DLWOSKR)VDW%{~}Z(A_N~6Q.png"><br>左图是单独调整的效果（叠加会爆白），右图是结合basecol调整后单独显示的结果（基本等于没有…）</p>
<h1 id="边缘光"><a href="#边缘光" class="headerlink" title="边缘光"></a>边缘光</h1><p>再来看边缘光部分，现在主流的边缘光实现方式基本就两种，一种菲涅尔，一种屏幕空间等距边缘光，当然也可以两种都用，但据我观察，原神的边缘光并不具备随视角变化而变化的特性，加上反而感觉有些画蛇添足，所以我这里就没加<br>屏幕空间等距边缘光的实现原理的话，可以参考下面这两篇文章，大概思路就是在原先模型深度的基础上沿法线方向外扩一段距离，再拿它和原深度值比较，二者深度差大于某个阈值的时候即判定为边缘<br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/365339160">Unity URP Shader 与 HLSL 自学笔记六 等宽屏幕空间边缘光</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/139290492">【JTRP】屏幕空间深度边缘光 Screen Space Depth Rimlight</a><br>有点像描边，但不用开新的pass，直接在片元做就完事了。我这里把之前用来做描边用的平滑法线复用了一下，虽然感觉没啥必要…代价就多了次矩阵运算，所以加不加就见仁见智吧<br><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//记得打开摄像机的深度纹理</span></span><br><span class="line">TEXTURE2D(_CameraDepthTexture); SAMPLER(sampler_CameraDepthTexture);</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 屏幕空间深度等宽边缘光</span></span><br><span class="line"><span class="comment">// 屏幕空间UV</span></span><br><span class="line">float2 RimScreenUV = float2(i.pos.x / _ScreenParams.x, i.pos.y / _ScreenParams.y);</span><br><span class="line"><span class="comment">// 法线外扩偏移UV，把worldNormal转换到NDC空间</span></span><br><span class="line">float3 smoothNormal = <span class="built_in">normalize</span>(UnpackNormalmapRGorAG(i.color));</span><br><span class="line">float3x3 tangentTransform = float3x3(i.worldTangent, i.worldBiTangent, i.worldNormal);</span><br><span class="line">float3 worldRimNormal = <span class="built_in">normalize</span>(mul(smoothNormal, tangentTransform));</span><br><span class="line">float2 RimOffsetUV = float2(mul((float3x3) UNITY_MATRIX_V, worldRimNormal).xy * _RimOffset * <span class="number">0.01</span> / i.pos.w);</span><br><span class="line">RimOffsetUV += RimScreenUV;</span><br><span class="line">                </span><br><span class="line"><span class="type">float</span> ScreenDepth = SAMPLE_DEPTH_TEXTURE(_CameraDepthTexture, sampler_CameraDepthTexture, RimScreenUV);</span><br><span class="line"><span class="type">float</span> Linear01ScreenDepth = LinearEyeDepth(ScreenDepth, _ZBufferParams);</span><br><span class="line"><span class="type">float</span> OffsetDepth = SAMPLE_DEPTH_TEXTURE(_CameraDepthTexture, sampler_CameraDepthTexture, RimOffsetUV);</span><br><span class="line"><span class="type">float</span> Linear01OffsetDepth = LinearEyeDepth(OffsetDepth, _ZBufferParams);</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> diff = Linear01OffsetDepth - Linear01ScreenDepth;</span><br><span class="line"><span class="type">float</span> rimMask = <span class="built_in">step</span>(_RimThreshold * <span class="number">0.1</span>, diff);</span><br><span class="line"><span class="comment">// 边缘光颜色的a通道用来控制边缘光强弱</span></span><br><span class="line">half4 RimColor = float4(rimMask * _RimColor.rgb * _RimColor.a, <span class="number">1</span>) * _EnableRim;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">Pass</span><br><span class="line">&#123;</span><br><span class="line">    Tags &#123;&quot;LightMode&quot; = &quot;DepthOnly&quot;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>插句题外话，这里是将世界法线转到NDC，除以w没什么好说的，而《入门精要》p275 讲到有关深度和法线纹理的效果的时候，从NDC重建世界坐标也做了一次“透视除法”，虽然这个和这里边缘光没啥关系，但当时看这里对这个步骤困惑了很久，想了想还是放在这里一并记下吧<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.nlark.com/yuque/0/2022/png/23115229/1651674911792-958413b7-5374-45bf-8fe9-9f53cd81e8df.png#averageHue=%23f8f8f8&amp;clientId=ua34e33ef-0961-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=393&amp;id=u63fee7e8&amp;originHeight=491&amp;originWidth=573&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=54649&amp;status=error&amp;style=none&amp;taskId=u64632915-1fbf-407f-8883-8e14df37fd1&amp;title=&amp;width=458.4" alt="FO~D]G9%]QA9T~46(KUODL5.png"><br>效果：<br>![0%CRZY3XALS6}57S)P@<a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2022/png/23115229/1651945531979-45f52b43-4599-4e80-8cf0-3ad8351bfb4e.png#averageHue=%234c4c4b&amp;clientId=u32c63bef-2a11-4&amp;errorMessage=unknown%20error&amp;from=paste&amp;height=379&amp;id=u270c7938&amp;originHeight=474&amp;originWidth=537&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=140985&amp;status=error&amp;style=none&amp;taskId=u9076feac-152d-4a0f-a3d2-70c62a77115&amp;title=&amp;width=429.6">OXE.png</a><br>prprpr<br>调整的过程中，需要注意边缘光是辅助元素，不能太过显眼，借用月神的话来说，就只要调到那种“不仔细看察觉不到”的程度即可（除非是风格需要）</p>
<h1 id="总结-amp-Future-Works"><a href="#总结-amp-Future-Works" class="headerlink" title="总结 &amp; Future Works"></a>总结 &amp; Future Works</h1><p>完整代码github链接：<br><a target="_blank" rel="noopener" href="https://github.com/YuiLu/GenshinCharacterShading">GitHub - YuiLu/GenshinCharacterShading: 通过编写一个仿原神渲染的shader，来学习URP和卡通渲染相关知识</a><br>除了某些显而易见的bug，还有很多个性化调整的点，比如shadow和shadowAO色调分离，Rim边缘软硬控制，body上第二层halfLambert等等等等，不胜枚举，目前计划是等暑假多学点东西之后，先把高光的问题修了（还有皮肤也有问题），在看着实现下头发的各向异性和眼睛的PBR…未来的工作还有很多，希望有一天能成为喵刀colin那样的大佬吧</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://YuiLu.github.io">Yui Lu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://yuilu.github.io/posts/44076.html">https://yuilu.github.io/posts/44076.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://YuiLu.github.io" target="_blank">Yui Lu</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Blogs/">Blogs</a><a class="post-meta__tags" href="/tags/%E5%8D%A1%E9%80%9A%E6%B8%B2%E6%9F%93/">卡通渲染</a></div><div class="post_share"><div class="social-share" data-image="/images/cover/result.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechatpay.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/wechatpay.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/alipay.png" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/21880.html" title="Billboard与施密特正交"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/cover/%E8%8A%99%E8%8E%89%E8%8E%B2_%E5%8B%87%E8%80%85%E5%8E%BB%E4%B8%96%E7%9A%84%E7%AC%AC100%E5%B9%B4_%E6%99%93%E7%9B%86%E5%8F%8B%E7%9A%84%E6%8F%92%E7%94%BB.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Billboard与施密特正交</div></div></a></div><div class="next-post pull-right"><a href="/posts/16402.html" title="B样条曲线-个人笔记"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/cover/@oekaki_bibbi%20%E7%B5%90%E6%9D%9F%E3%83%90%E3%83%B3%E3%83%89%E6%81%92%E6%98%9F%E3%81%86%E3%81%8A%E3%81%8A%E3%81%8A%E3%81%8A%E3%81%8A%EF%BC%81%E5%86%8D%E6%8E%B2.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">B样条曲线-个人笔记</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/21880.html" title="Billboard与施密特正交"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/cover/%E8%8A%99%E8%8E%89%E8%8E%B2_%E5%8B%87%E8%80%85%E5%8E%BB%E4%B8%96%E7%9A%84%E7%AC%AC100%E5%B9%B4_%E6%99%93%E7%9B%86%E5%8F%8B%E7%9A%84%E6%8F%92%E7%94%BB.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-01-17</div><div class="title">Billboard与施密特正交</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/bocchi.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Yui Lu</div><div class="author-info__description">Ciallo～(∠・ω< )⌒☆</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">17</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://www.zhihu.com/people/zhang-jia-hui-55-74"><i class="fab fa-zhihu"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/YuiLu" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="tencent://message/?Menu=yes&amp;uin=2903077287" target="_blank" title="'#24292e'"><i class="fab fa-qq"></i></a><a class="social-icon" href="mailto:b2903077287@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #24292e;"></i></a><a class="social-icon" href="https://space.bilibili.com/23208863?spm_id_from=333.1007.0.0" target="_blank" title="bilibili"><i class="fab fa-bilibili" style="color: #24292e;"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A3%8E%E6%A0%BC%E5%88%86%E6%9E%90"><span class="toc-text">风格分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5"><span class="toc-text">一些概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%A5%9E%E7%9A%84%E8%A7%92%E8%89%B2%E6%B8%B2%E6%9F%93"><span class="toc-text">原神的角色渲染</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B4%B4%E5%9B%BE%E5%88%86%E6%9E%90"><span class="toc-text">贴图分析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8F%8F%E8%BE%B9"><span class="toc-text">描边</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Ramp"><span class="toc-text">Ramp</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SDF%E8%84%B8%E9%83%A8%E9%98%B4%E5%BD%B1"><span class="toc-text">SDF脸部阴影</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B5%84%E4%BA%A7%E7%94%9F%E6%88%90"><span class="toc-text">资产生成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8ssedt"><span class="toc-text">8ssedt</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E5%80%BC%E5%9B%BE%E8%9E%8D%E5%90%88"><span class="toc-text">二值图融合</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%B4%B4%E5%9B%BE"><span class="toc-text">使用贴图</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%AB%98%E5%85%89"><span class="toc-text">高光</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BE%B9%E7%BC%98%E5%85%89"><span class="toc-text">边缘光</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-amp-Future-Works"><span class="toc-text">总结 &amp; Future Works</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/21880.html" title="Billboard与施密特正交"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/cover/%E8%8A%99%E8%8E%89%E8%8E%B2_%E5%8B%87%E8%80%85%E5%8E%BB%E4%B8%96%E7%9A%84%E7%AC%AC100%E5%B9%B4_%E6%99%93%E7%9B%86%E5%8F%8B%E7%9A%84%E6%8F%92%E7%94%BB.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Billboard与施密特正交"/></a><div class="content"><a class="title" href="/posts/21880.html" title="Billboard与施密特正交">Billboard与施密特正交</a><time datetime="2024-01-17T14:57:44.000Z" title="发表于 2024-01-17 22:57:44">2024-01-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/44076.html" title="从零开始的URP仿原神角色渲染"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/cover/result.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="从零开始的URP仿原神角色渲染"/></a><div class="content"><a class="title" href="/posts/44076.html" title="从零开始的URP仿原神角色渲染">从零开始的URP仿原神角色渲染</a><time datetime="2024-01-17T08:00:00.000Z" title="发表于 2024-01-17 16:00:00">2024-01-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/16402.html" title="B样条曲线-个人笔记"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/cover/@oekaki_bibbi%20%E7%B5%90%E6%9D%9F%E3%83%90%E3%83%B3%E3%83%89%E6%81%92%E6%98%9F%E3%81%86%E3%81%8A%E3%81%8A%E3%81%8A%E3%81%8A%E3%81%8A%EF%BC%81%E5%86%8D%E6%8E%B2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="B样条曲线-个人笔记"/></a><div class="content"><a class="title" href="/posts/16402.html" title="B样条曲线-个人笔记">B样条曲线-个人笔记</a><time datetime="2024-01-17T07:00:00.000Z" title="发表于 2024-01-17 15:00:00">2024-01-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/12444.html" title="GAMES202个人笔记（1）-基础引入"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/YuiLu/Image_host@main/GAMES202/1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="GAMES202个人笔记（1）-基础引入"/></a><div class="content"><a class="title" href="/posts/12444.html" title="GAMES202个人笔记（1）-基础引入">GAMES202个人笔记（1）-基础引入</a><time datetime="2024-01-16T10:00:00.000Z" title="发表于 2024-01-16 18:00:00">2024-01-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/5734.html" title="GAMES202个人笔记（2）-实时阴影"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/YuiLu/Image_host@main/GAMES202/1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="GAMES202个人笔记（2）-实时阴影"/></a><div class="content"><a class="title" href="/posts/5734.html" title="GAMES202个人笔记（2）-实时阴影">GAMES202个人笔记（2）-实时阴影</a><time datetime="2024-01-15T10:00:00.000Z" title="发表于 2024-01-15 18:00:00">2024-01-15</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By Yui Lu</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-butterfly/4.12.0/js/utils.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-butterfly/4.12.0/js/main.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-butterfly/4.12.0/js/tw_cn.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.32/fancybox/fancybox.umd.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/17.8.5/lazyload.iife.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script></div><script id="canvas_nest" defer="defer" color="128,128,128" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/canvas-nest.min.js"></script><script id="click-heart" src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-butterfly/4.12.0/js/search/local-search.min.js"></script></div></div></body></html>